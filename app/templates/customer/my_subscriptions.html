{% extends "base.html" %}

{% block content %}
<!-- Back Button -->
<div class="mb-6">
    <a href="{{ url_for('customer.index') }}"
        class="inline-flex items-center gap-2 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-bold transition">
        <i class="fas fa-arrow-right"></i>
        رجوع
    </a>
</div>

<div class="mb-6">
    <h2 class="text-2xl font-bold text-white mb-2">اشتراكاتي</h2>
    <p class="text-gray-400">جميع اشتراكاتك في الباقات</p>
</div>

<div class="mb-6">
    <a href="{{ url_for('customer.subscribe_flow') }}"
        class="inline-block bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-bold transition">
        <i class="fas fa-plus ml-2"></i>اشتراك جديد
    </a>
</div>

<div class="space-y-4">
    {% for subscription in subscriptions %}
    <div class="bg-primary rounded-lg shadow-lg p-6 border-r-4 
        {% if subscription.status == 'active' %}border-green-500
        {% elif subscription.status == 'pending' %}border-yellow-500
        {% elif subscription.status == 'rejected' %}border-red-500
        {% else %}border-gray-500{% endif %}">

        <div class="flex justify-between items-start mb-4">
            <div>
                <h3 class="text-xl font-bold text-white">
                    {{ subscription.package.name_ar if subscription.package else subscription.plan_type }}
                </h3>
                {% if subscription.package %}
                <p class="text-sm text-gray-400 mt-1">{{ subscription.package.name_en }}</p>
                {% endif %}
            </div>
            <span class="px-3 py-1 rounded-full text-sm font-bold
                {% if subscription.status == 'active' %}bg-green-900 bg-opacity-30 text-green-400
                {% elif subscription.status == 'pending' %}bg-yellow-900 bg-opacity-30 text-yellow-400
                {% elif subscription.status == 'rejected' %}bg-red-900 bg-opacity-30 text-red-400
                {% else %}bg-gray-700 text-gray-300{% endif %}">
                {% if subscription.status == 'active' %}نشط
                {% elif subscription.status == 'pending' %}قيد الانتظار
                {% elif subscription.status == 'rejected' %}مرفوض
                {% elif subscription.status == 'expired' %}منتهي
                {% else %}{{ subscription.status }}{% endif %}
            </span>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
            <div class="bg-darkbg rounded-lg p-3">
                <p class="text-xs text-gray-400 mb-1">الغسلات المتبقية</p>
                <p class="text-xl font-bold text-white">{{ subscription.remaining_washes }}</p>
            </div>
            {% if subscription.package %}
            <div class="bg-darkbg rounded-lg p-3">
                <p class="text-xs text-gray-400 mb-1">إجمالي الغسلات</p>
                <p class="text-xl font-bold text-white">{{ subscription.package.wash_count }}</p>
            </div>
            {% endif %}
            {% if subscription.start_date %}
            <div class="bg-darkbg rounded-lg p-3">
                <p class="text-xs text-gray-400 mb-1">تاريخ البدء</p>
                <p class="text-sm font-bold text-white">{{ subscription.start_date.strftime('%Y-%m-%d') }}</p>
            </div>
            {% endif %}
            {% if subscription.end_date %}
            <div class="bg-darkbg rounded-lg p-3">
                <p class="text-xs text-gray-400 mb-1">تاريخ الانتهاء</p>
                <p class="text-sm font-bold text-white">{{ subscription.end_date.strftime('%Y-%m-%d') }}</p>
            </div>
            {% endif %}
        </div>

        {% if subscription.neighborhood %}
        <div class="flex items-center text-gray-300 text-sm">
            <i class="fas fa-map-marker-alt ml-2 text-gray-500"></i>
            <span>{{ subscription.neighborhood.city.name_ar }} - {{ subscription.neighborhood.name_ar }}</span>
        </div>
        {% endif %}

        <!-- Book Wash Button for Active Subscriptions -->
        {% if subscription.status == 'active' and subscription.remaining_washes > 0 %}
        <div class="mt-4 pt-4 border-t border-gray-700">
            <a href="{{ url_for('customer.book_subscription_wash', subscription_id=subscription.id) }}"
                class="inline-flex items-center justify-center w-full gap-2 bg-accent hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-bold transition">
                <i class="fas fa-calendar-plus"></i>
                حجز غسلة
            </a>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="bg-primary rounded-lg shadow-lg p-12 text-center">
        <i class="fas fa-inbox text-6xl text-gray-600 mb-4"></i>
        <p class="text-gray-400 text-lg">لا توجد اشتراكات حالياً</p>
        <a href="{{ url_for('customer.subscribe_flow') }}" class="inline-block mt-4 text-accent hover:underline">
            ابدأ الاشتراك الآن
        </a>
    </div>
    {% endfor %}
</div>
{% endblock %}