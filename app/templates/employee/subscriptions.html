{% extends "base.html" %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h2 class="text-2xl font-bold text-white">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³Ù†Ø¯Ø©</h2>
        <p class="text-gray-400">{{ subscriptions|length }} Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø·</p>
    </div>
    <a href="{{ url_for('employee.index') }}"
        class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded transition">
        <i class="fas fa-arrow-right ml-2"></i> Ø±Ø¬ÙˆØ¹
    </a>
</div>

{% if subscriptions %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    {% for subscription in subscriptions %}
    <div class="bg-primary p-6 rounded-lg shadow-lg">
        <div class="flex justify-between items-start mb-4">
            <div>
                <h3 class="text-lg font-bold text-white">Ø§Ø´ØªØ±Ø§Ùƒ #{{ subscription.id }}</h3>
                <span class="inline-block px-3 py-1 rounded text-xs font-bold mt-2 bg-green-600">Ù†Ø´Ø·</span>
            </div>
            <div class="text-center">
                <div class="bg-accent text-white rounded-full w-16 h-16 flex items-center justify-center">
                    <span class="text-2xl font-bold">{{ subscription.remaining_washes }}</span>
                </div>
                <p class="text-xs text-gray-400 mt-1">ØºØ³Ù„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©</p>
            </div>
        </div>

        <div class="space-y-3 mb-4">
            <div>
                <p class="text-gray-400 text-sm mb-1">Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
                <p class="text-white font-bold">{{ subscription.customer.username }}</p>
                <p class="text-gray-400 text-sm">{{ subscription.customer.phone }}</p>
            </div>

            {% if subscription.package %}
            <div>
                <p class="text-gray-400 text-sm mb-1">Ø§Ù„Ø¨Ø§Ù‚Ø©</p>
                <p class="text-white">{{ subscription.package.name_ar }}</p>
                <p class="text-gray-400 text-sm">{{ subscription.package.washes }} ØºØ³Ù„Ø© - {{
                    subscription.package.duration_days }} ÙŠÙˆÙ…</p>
            </div>
            {% endif %}

            {% if subscription.vehicle %}
            <div>
                <p class="text-gray-400 text-sm mb-1">Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</p>
                <p class="text-white">{{ subscription.vehicle.brand }}</p>
                <p class="text-gray-400 text-sm">{{ subscription.vehicle.plate_number }}</p>
            </div>
            {% endif %}

            <div>
                <p class="text-gray-400 text-sm mb-1">Ø§Ù„Ù…Ø¯Ø©</p>
                <p class="text-white">{{ subscription.start_date }} - {{ subscription.end_date }}</p>
            </div>

            {% if subscription.neighborhood %}
            <div>
                <p class="text-gray-400 text-sm mb-1">Ø§Ù„Ø­ÙŠ</p>
                <p class="text-white">{{ subscription.neighborhood.name_ar }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Actions -->
        <div class="grid grid-cols-1 gap-2">
            {% set whatsapp_phone = '966' + subscription.customer.phone[1:] if
            subscription.customer.phone.startswith('0') else subscription.customer.phone %}
            <a href="https://wa.me/{{ whatsapp_phone }}?text=Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø£Ø³ØªØ§Ø°/Ø£Ø³ØªØ§Ø°Ø© Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ%0aÙ…Ø¹Ùƒ Ù…ÙˆØ¸Ù Silver Clean.%0aÙ„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙƒ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ØŒ ÙØ¶Ù„Ø§Ù‹ Ø£Ø±Ø³Ù„ Ù„ÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ Ø£Ùˆ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.%0a%0aØ´ÙƒØ±Ù‹Ø§ Ù„Ùƒ ÙˆÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø®Ø¯Ù…ØªÙƒ ðŸŒŸðŸš—"
                target="_blank"
                class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded text-center transition">
                <i class="fab fa-whatsapp ml-2"></i> ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨
            </a>

            {% if subscription.remaining_washes > 0 %}
            <form action="{{ url_for('employee.complete_wash', id=subscription.id) }}" method="post">
                <button type="submit"
                    class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded transition"
                    onclick="return confirm('Ù‡Ù„ ØªØ£ÙƒØ¯Øª Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØºØ³Ù„Ø©ØŸ')">
                    <i class="fas fa-check ml-2"></i> Ø¥ØªÙ…Ø§Ù… ØºØ³Ù„Ø©
                </button>
            </form>
            {% else %}
            <button disabled class="w-full bg-gray-600 text-gray-400 font-bold py-2 px-4 rounded cursor-not-allowed">
                Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ³Ù„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©
            </button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="bg-primary p-8 rounded-lg shadow-lg text-center">
    <i class="fas fa-box-open text-4xl text-gray-500 mb-4"></i>
    <p class="text-xl text-white">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù…Ø³Ù†Ø¯Ø©</p>
    <p class="text-gray-400">Ø³ÙŠØªÙ… Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
</div>
{% endif %}
{% endblock %}